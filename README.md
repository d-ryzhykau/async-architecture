# Awesome Task Exchange System
В результате анализа требований были выявлены следующие предметные области:
* tasks - управление задачами;
* finance - учёт финансовых операций, расчёт финансовой аналитики.
* auth - управление пользователями, логин;

Каждая предметная область имеет набор тесно связанных операций и данных. Также
у разных предметных областей разный приоритет для бизнеса:
* tasks - основная предметная область с наивысшим приоритетом для разработки;
* finance - поддерживающая область;
* auth - неспециализированная область, можно использовать готовое решение
  (например Keycloak).

Поэтому каждая предметная область должна быть представлена отдельным сервисом.
Названия сервисов совпадают с названиями предметных областей.

## Коммуникации

### Асинхронные
О возникновении событий, которые могут представлять интерес
для других сервисов, сервисы должны оповещать окружение с помощью сообщений.
Для обмена сообщениями будет использована RabbitMQ, т.к. с этим сервисом
я работал и он предоставляет всё необходимое для реализации требуемой системы.

Каждый тип сообщений должен иметь отдельный ключ (`routing_key`).
Ключи сообщений должны иметь следующий формат:
```
<service_name>.<entity_name>.<event_name>
```
`<service_name>` - название сервиса, отправляющего сообщение.
`<entity_name>` - название сущности, с которой произошло событие.
`<event_name>` - название события.

Сообщения должны публиковаться в общий topic exchange, чтобы
сервисы-потребители могли подписаться только на типы событий, которые им нужно
обрабатывать.

Данные внутри сообщений будут закодированы с помощью JSON.

### Синхронные
Для получения данных из другого сервиса в момент обработки команд и событий
сервисы могут использовать REST API друг друга.

Сервисы должны проверять machine-to-machine токены для авторизации запросов
от других сервисов, чтобы не допустить утечки данных.

## Сервисы

### Tasks

#### Операции
Сервис должен предоставлять весь функционал дашборда с задачами:
* отображение списка задач (в т.ч. назначенных на текущего пользователя);
* создание задач;
* рандомное назначение задач.

#### Данные
Сервис должен хранить задачи с описанием, стоимостью и ссылкой на исполнителя.
Также будет поддерживаться локальный кэш активных пользователей системы для
выбора рандомного сотрудника при выборе исполнителя.

#### Исходящие сообщения
`tasks.task.created` - создана новая задача.
```jsonc
{
  "task_uuid": "uuid", // уникальный UUID задачи
  "assigned_to": "uuid", // UUID пользователя исполнителя задачи
}
```

`tasks.task.completed` - задача отмечена как выполненная.
```jsonc
{
  "task_uuid": "uuid" // уникальный UUID задачи
}
```

`tasks.task.reassigned` - исполнитель задачи изменён
```jsonc
{
  "task_uuid": "uuid", // уникальный UUID задачи
  "from": "uuid", // UUID бывшего исполнителя задачи
  "to": "uuid", // UUID нового исполнителя задачи
}
```

#### Входящие сообщения
`auth.user.created` - сохранение пользователя в локальном кэше.
`auth.user.changed` - обновление данных пользователя в локальном кэше.
`auth.user.deleted` - удаление пользователя из локального кэша.

#### REST API
`GET /tasks/{uuid}` - получение данных о задаче.

### Finance

#### Операции
Сервис должен предоставлять дашборд с ценами задач, а также выводить количество
заработанных топ-менеджментом денег за текущие сутки.

Также сервис выполняет ежедневную рассылку с информацией о выплатах
по итогам дня.

#### Данные
Сервис должен хранить данные о событиях назначения, выполнения и переназначения
задач на исполнителей, а также цены всех задач.

Если события должны отображать состояние связанной задачи актуальное на момент
возникновения события, каждое событие будет включать в себя поля для хранения
этого состояния.

Если письма о состоянии счёта сотрудника на момент окончания рабочего дня
необходимо отправлять всем сотрудникам, а не только тем, кому за день задачи
были назначены или кем они были выполнены, необходимо хранение локального кэша
пользователей.

#### Входящие сообщения
`tasks.task.created` - сохранение цен для задачи, сохранение события назначения
задачи на исполнителя.
`tasks.task.completed` - сохранение события выполнения задачи.
`tasks.task.reassigned` - сохранение события об изменении исполнителя.
`auth.user.created` - сохранение пользователя в локальном кэше.
`auth.user.changed` - обновление данных пользователя в локальном кэше.
`auth.user.deleted` - удаление пользователя из локального кэша.

### Auth
Сервис должен поддерживать OpenID Connect или OAuth2 для аутентификации
пользователей в других сервисах системы.

#### Данные
Сервис должен хранить данные для аутентификации пользователей (логин, пароль),
их роль в системе (администратор, менеджер, бухгалтер, сотрудник).

#### Исходящие сообщения
`auth.user.created` - пользователь добавлен в систему.
`auth.user.changed` - данные пользователя поменялись.
`auth.user.deleted` - пользователь удалён из системы.

#### REST API
`GET /users/{uuid}` - получение данных о пользователей (почта, роль, и т.д.).

# TODO
* Более подробное описание коммуникаций
  (например, некоторые синхронные коммуникации используют REST API)
* Проблемы
* Спорные места
